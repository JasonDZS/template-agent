# æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆå™¨ (Template Agent)

åŸºäºæ¨¡æ¿å’ŒçŸ¥è¯†åº“çš„æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿï¼Œæ”¯æŒä»Markdownæˆ–JSONæ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Šã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½å†…å®¹ç”Ÿæˆ**ï¼šåŸºäºé¢„å®šä¹‰æ¨¡æ¿è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šå†…å®¹
- ğŸ“š **çŸ¥è¯†åº“æ£€ç´¢**ï¼šè‡ªåŠ¨ä»æ–‡æ¡£åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯
- ğŸ”„ **æ ¼å¼è½¬æ¢**ï¼šæ”¯æŒMarkdownå’ŒJSONæ ¼å¼äº’è½¬
- âš¡ **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒç« èŠ‚å¹¶è¡Œç”Ÿæˆï¼Œæé«˜æ•ˆç‡
- ğŸ“Š **è¿›åº¦è·Ÿè¸ª**ï¼šå®æ—¶è·Ÿè¸ªç”Ÿæˆè¿›åº¦
- ğŸ¯ **çµæ´»é…ç½®**ï¼šæ”¯æŒå¤šç§æ¨¡å‹å’ŒAPIé…ç½®

## ç³»ç»Ÿæ¶æ„

```mermaid
flowchart TD
      A[ç”¨æˆ·è¾“å…¥æ–‡æ¡£å’Œæ¨¡æ¿] --> B[ReportGeneratorAgentåˆå§‹åŒ–]
      B --> C[åŠ è½½æ¨¡æ¿å†…å®¹]
      C --> D{æ¨¡æ¿æ ¼å¼?}
      D -->|Markdown| E[è½¬æ¢ä¸ºJSONç»“æ„]
      D -->|JSON| F[ç›´æ¥è§£æJSON]
      E --> G[åˆå§‹åŒ–æŠ¥å‘Šç»“æ„]
      F --> G
      G --> H[åˆ›å»ºSectionAgentå®ä¾‹]
      H --> I[å¼€å§‹æŠ¥å‘Šç”Ÿæˆ]

      subgraph æŠ¥å‘Šç”Ÿæˆé˜¶æ®µ
      I --> J{ç”Ÿæˆæ¨¡å¼?}
      J -->|ä¸²è¡Œæ¨¡å¼| K[æŒ‰é¡ºåºç”Ÿæˆç« èŠ‚]
      J -->|å¹¶è¡Œæ¨¡å¼| L[å¹¶å‘ç”Ÿæˆç« èŠ‚]

      K --> M[é€‰æ‹©ä¸‹ä¸€ç« èŠ‚]
      M --> N[è¿è¡ŒSectionAgent]
      N --> O[ä»çŸ¥è¯†åº“æ£€ç´¢ä¿¡æ¯]
      O --> P[ç”Ÿæˆç« èŠ‚å†…å®¹]
      P --> Q[æ›´æ–°ç« èŠ‚çŠ¶æ€]
      Q --> R{è¿˜æœ‰ç« èŠ‚?}
      R -->|æ˜¯| M

      L --> S[åˆ›å»ºå¹¶å‘ä»»åŠ¡]
      S --> T[åŒæ—¶è¿è¡Œå¤šä¸ªSectionAgent]
      T --> U[ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ]
      U --> V[å¤„ç†å¹¶å‘ç»“æœ]
      V --> W{è¿˜æœ‰ç« èŠ‚?}
      W -->|æ˜¯| L
      end

      R -->|å¦| X{å¯ç”¨æ¶¦è‰²?}
      W -->|å¦| X
      X -->|å¦| Y[ä¿å­˜æŠ¥å‘Š]
      X -->|æ˜¯| Z[å†…å®¹è´¨é‡è¯„ä¼°]

      subgraph å†…å®¹æ¶¦è‰²é˜¶æ®µ
      Z --> AA[è¯†åˆ«è´¨é‡é—®é¢˜]
      AA --> BB{æœ‰è´¨é‡é—®é¢˜?}
      BB -->|æ˜¯| CC[å†…å®¹æ¶¦è‰²ä¼˜åŒ–]
      BB -->|å¦| DD[ä¸€è‡´æ€§æ£€æŸ¥]
      CC --> DD
      DD --> EE{æœ‰ä¸€è‡´æ€§é—®é¢˜?}
      EE -->|æ˜¯| FF[ä¿®å¤ä¸€è‡´æ€§é—®é¢˜]
      EE -->|å¦| GG[æœ€ç»ˆè´¨é‡æ£€æŸ¥]
      FF --> GG
      GG --> HH{è´¨é‡é€šè¿‡?}
      HH -->|æ˜¯| II[æ ‡è®°æ¶¦è‰²å®Œæˆ]
      HH -->|å¦| JJ[è®°å½•è´¨é‡é—®é¢˜]
      JJ --> II
      end

      II --> Y
      Y --> KK[ç”ŸæˆJSONæ ¼å¼]
      KK --> LL[è½¬æ¢ä¸ºMarkdown]
      LL --> MM[ä¿å­˜åˆ°æ–‡ä»¶]
      MM --> NN[è¿”å›ç”Ÿæˆç»“æœ]

      style A fill:#e1f5fe
      style NN fill:#c8e6c9
      style Z fill:#fff3e0
      style Y fill:#f3e5f5
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python >= 3.11
- OpenAI API Key æˆ–å…¼å®¹çš„APIæœåŠ¡

### å®‰è£…ä¾èµ–

```bash
pip install -e .
```

### ç¯å¢ƒé…ç½®

1. å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®APIä¿¡æ¯ï¼š
```env
OPENAI_API_BASE=https://api.openai.com/v1
OPENAI_API_KEY=your_openai_api_key_here
LLM_MODEL=gpt-3.5-turbo
LLM_MAX_TOKENS=4096

EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_MAX_TOKENS=8192
EMBEDDING_DIM=1536
```

### åŸºæœ¬ç”¨æ³•

#### 1. åˆ—å‡ºå¯ç”¨æ¨¡æ¿
```bash
python main.py list
```

#### 2. ç”ŸæˆæŠ¥å‘Š
```bash
python main.py generate --template "ä¼šè®®æ¨¡æ¿.md" --output "æˆ‘çš„ä¼šè®®æŠ¥å‘Š"
```

#### 3. æµ‹è¯•çŸ¥è¯†åº“
```bash
python main.py test --query "æ™ºèƒ½é‹å«"
```

#### 4. è½¬æ¢æ¨¡æ¿æ ¼å¼
```bash
python main.py convert --template "æ¨¡æ¿.md" --format json
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | æè¿° | é»˜è®¤å€¼ |
|------|------|--------|
| `action` | æ‰§è¡Œæ“ä½œï¼šgenerate/convert/test/list | å¿…éœ€ |
| `--template, -t` | æ¨¡æ¿åç§°æˆ–è·¯å¾„ | - |
| `--output, -o` | è¾“å‡ºæ–‡ä»¶å | è‡ªåŠ¨ç”Ÿæˆ |
| `--format, -f` | è½¬æ¢ç›®æ ‡æ ¼å¼ï¼šjson/markdown | json |
| `--query, -q` | æµ‹è¯•æŸ¥è¯¢å†…å®¹ | "æ™ºèƒ½é‹å«" |
| `--max-steps` | æœ€å¤§æ‰§è¡Œæ­¥æ•° | 20 |
| `--knowledge-base` | çŸ¥è¯†åº“è·¯å¾„ | workdir/documents |
| `--template-base` | æ¨¡æ¿åŸºç¡€è·¯å¾„ | workdir/template |

## ç›®å½•ç»“æ„

```
template-agent/
â”œâ”€â”€ app/                      # æ ¸å¿ƒåº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ agent/               # Agentç›¸å…³æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ base.py         # åŸºç¡€Agentç±»
â”‚   â”‚   â”œâ”€â”€ react.py        # ReActæ¨¡å¼Agent
â”‚   â”‚   â”œâ”€â”€ toolcall.py     # å·¥å…·è°ƒç”¨Agent
â”‚   â”‚   â”œâ”€â”€ section_agent.py # ç« èŠ‚ç”ŸæˆAgent
â”‚   â”‚   â””â”€â”€ report_generator.py # æŠ¥å‘Šç”ŸæˆAgent
â”‚   â”œâ”€â”€ tool/               # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ base.py         # åŸºç¡€å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ knowledge_retrieval.py # çŸ¥è¯†æ£€ç´¢å·¥å…·
â”‚   â”‚   â”œâ”€â”€ create_chat_completion.py # LLMè°ƒç”¨å·¥å…·
â”‚   â”‚   â””â”€â”€ terminate.py    # ç»ˆæ­¢å·¥å…·
â”‚   â”œâ”€â”€ prompt/             # æç¤ºè¯æ¨¡æ¿
â”‚   â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ converter.py        # æ ¼å¼è½¬æ¢å™¨
â”‚   â”œâ”€â”€ llm.py             # LLMå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ logger.py          # æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ schema.py          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ type.py            # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ exceptions.py      # å¼‚å¸¸å¤„ç†
â”œâ”€â”€ workdir/                # å·¥ä½œç›®å½•
â”‚   â”œâ”€â”€ documents/          # çŸ¥è¯†åº“æ–‡æ¡£
â”‚   â”œâ”€â”€ template/           # æŠ¥å‘Šæ¨¡æ¿
â”‚   â””â”€â”€ output/             # ç”Ÿæˆç»“æœ
â”œâ”€â”€ main.py                 # ç¨‹åºå…¥å£
â”œâ”€â”€ pyproject.toml          # é¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt        # ä¾èµ–åˆ—è¡¨
â””â”€â”€ .env.example           # ç¯å¢ƒé…ç½®ç¤ºä¾‹
```

## æ ¸å¿ƒç»„ä»¶

### ReportGeneratorAgent
ä¸»è¦çš„æŠ¥å‘Šç”Ÿæˆä»£ç†ï¼Œè´Ÿè´£ï¼š
- æ¨¡æ¿è§£æå’ŒéªŒè¯
- ç« èŠ‚ä»»åŠ¡åˆ†é…
- ç”Ÿæˆè¿›åº¦è·Ÿè¸ª
- ç»“æœæ±‡æ€»å’Œä¿å­˜

### SectionAgent  
ç« èŠ‚ç”Ÿæˆä»£ç†ï¼Œè´Ÿè´£ï¼š
- å•ä¸ªç« èŠ‚å†…å®¹ç”Ÿæˆ
- çŸ¥è¯†åº“ä¿¡æ¯æ£€ç´¢
- å†…å®¹è´¨é‡æ§åˆ¶

### KnowledgeRetrievalTool
çŸ¥è¯†æ£€ç´¢å·¥å…·ï¼Œæ”¯æŒï¼š
- è¯­ä¹‰æœç´¢
- å…³é”®è¯åŒ¹é…
- ç›¸å…³æ€§æ’åº

### MarkdownConverter
æ ¼å¼è½¬æ¢å™¨ï¼Œæ”¯æŒï¼š
- Markdown â†” JSON äº’è½¬
- ç»“æ„åŒ–æ•°æ®æå–
- å…ƒæ•°æ®ä¿ç•™

## é…ç½®é€‰é¡¹

### LLMè®¾ç½®
- `model`: æ¨¡å‹åç§°
- `base_url`: APIåŸºç¡€URL
- `api_key`: APIå¯†é’¥
- `max_tokens`: æœ€å¤§ä»¤ç‰Œæ•°
- `temperature`: é‡‡æ ·æ¸©åº¦

### åµŒå…¥æ¨¡å‹è®¾ç½®
- `EMBEDDING_MODEL`: åµŒå…¥æ¨¡å‹åç§°
- `EMBEDDING_PROVIDER`: æä¾›å•†ï¼ˆopenai/hf/ollamaï¼‰
- `EMBEDDING_DIM`: å‘é‡ç»´åº¦
- `EMBEDDING_MAX_TOKEN_SIZE`: æœ€å¤§ä»¤ç‰Œå¤§å°

### ç”Ÿæˆè®¾ç½®
- `parallel_sections`: æ˜¯å¦å¹¶è¡Œç”Ÿæˆç« èŠ‚
- `max_concurrent`: æœ€å¤§å¹¶å‘æ•°

## ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿

1. åœ¨ `workdir/template/` ç›®å½•ä¸‹åˆ›å»ºMarkdownæ¨¡æ¿ï¼š

```markdown
# äº§å“éœ€æ±‚è¯„å®¡ä¼šè®®

## ä¼šè®®åŸºæœ¬ä¿¡æ¯
- ä¼šè®®æ—¶é—´ï¼š
- å‚ä¼šäººå‘˜ï¼š
- ä¼šè®®ç›®æ ‡ï¼š

## äº§å“éœ€æ±‚æ¦‚è¿°
### éœ€æ±‚èƒŒæ™¯
<!-- è¯·æè¿°äº§å“éœ€æ±‚çš„èƒŒæ™¯å’ŒåŸå›  -->

### æ ¸å¿ƒåŠŸèƒ½
<!-- è¯·åˆ—å‡ºæ ¸å¿ƒåŠŸèƒ½ç‚¹ -->

## æŠ€æœ¯è¯„å®¡
### æŠ€æœ¯å¯è¡Œæ€§
<!-- è¯„ä¼°æŠ€æœ¯å®ç°éš¾åº¦ -->

### èµ„æºéœ€æ±‚
<!-- è¯„ä¼°æ‰€éœ€èµ„æº -->

## é£é™©è¯„ä¼°
### æŠ€æœ¯é£é™©
<!-- è¯†åˆ«æŠ€æœ¯é£é™© -->

### æ—¶é—´é£é™©  
<!-- è¯„ä¼°æ—¶é—´é£é™© -->

## å†³ç­–ç»“æœ
### æœ€ç»ˆå†³å®š
<!-- ä¼šè®®å†³ç­–ç»“æœ -->

### åç»­è¡ŒåŠ¨
<!-- åç»­è¡ŒåŠ¨è®¡åˆ’ -->
```

2. è¿è¡Œç”Ÿæˆå‘½ä»¤ï¼š
```bash
python main.py generate --template "äº§å“éœ€æ±‚è¯„å®¡ä¼šè®®.md"
```

### æ·»åŠ çŸ¥è¯†åº“æ–‡æ¡£

å°†ç›¸å…³æ–‡æ¡£æ”¾å…¥ `workdir/documents/` ç›®å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç´¢å¼•å’Œæ£€ç´¢ã€‚

## å¼€å‘è¯´æ˜

### æ‰©å±•æ–°å·¥å…·

1. åœ¨ `app/tool/` ç›®å½•ä¸‹åˆ›å»ºæ–°å·¥å…·ç±»
2. ç»§æ‰¿ `BaseTool` ç±»
3. å®ç° `execute` æ–¹æ³•
4. åœ¨Agentä¸­æ³¨å†Œå·¥å…·

### è‡ªå®šä¹‰Agent

1. ç»§æ‰¿ `BaseAgent` ç±»
2. å®ç°å¿…è¦çš„æ–¹æ³•
3. é…ç½®å·¥å…·å’Œæç¤ºè¯
